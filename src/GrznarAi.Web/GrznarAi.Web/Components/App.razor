<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="GrznarAI - Personal website with blog, projects and meteo data" />
    <base href="/" />
    <link rel="stylesheet" href="@Assets["lib/bootstrap/dist/css/bootstrap.min.css"]" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" />
    <link rel="stylesheet" href="@Assets["css/modern-style.css"]" />
    <link rel="stylesheet" href="@Assets["app.css"]" />
    <link rel="stylesheet" href="@Assets["GrznarAi.Web.styles.css"]" />
    <ImportMap />
    <link rel="icon" type="image/svg+xml" href="favicon.svg" />

    <!-- PSC.Blazor.Components.MarkdownEditor CSS -->
    <link rel="stylesheet" href="https://unpkg.com/easymde/dist/easymde.min.css">
    <link rel="stylesheet" href="_content/PSC.Blazor.Components.MarkdownEditor/css/style.css" />

    <HeadOutlet />
</head>

<body>
    <Routes />
    <script src="_framework/blazor.web.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>

    <!-- PSC.Blazor.Components.MarkdownEditor JS -->
    <script src="https://unpkg.com/easymde/dist/easymde.min.js"></script>
    <script src="_content/PSC.Blazor.Components.MarkdownEditor/js/MarkdownEditor.js"></script>
    
    <!-- Blog comments and voting JS -->
    <script src="@Assets["js/blog-comments.js"]"></script>

    <script>
        // Theme toggle functionality
        window.toggleTheme = (isDark) => {
            try {
                // Set the theme attribute
                document.documentElement.setAttribute('data-bs-theme', isDark ? 'dark' : 'light');

                // Store the preference
                localStorage.setItem('theme', isDark ? 'dark' : 'light');

                // Apply additional class for our own styles
                if (isDark) {
                    document.body.classList.add('dark-theme');
                    document.body.classList.remove('light-theme');
                } else {
                    document.body.classList.add('light-theme');
                    document.body.classList.remove('dark-theme');
                }

                console.log('Theme toggled to:', isDark ? 'dark' : 'light');
                return true;
            } catch (error) {
                console.error('Error toggling theme:', error);
                return false;
            }
        };

        // Check if user prefers dark mode
        window.isDarkModePreferred = () => {
            try {
                // Check localStorage first
                const savedTheme = localStorage.getItem('theme');
                if (savedTheme) {
                    console.log('Using saved theme preference:', savedTheme);
                    return savedTheme === 'dark';
                }

                // Then check system preference
                const systemPreference = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
                console.log('Using system theme preference:', systemPreference ? 'dark' : 'light');
                return systemPreference;
            } catch (error) {
                console.error('Error checking theme preference:', error);
                return false; // Default to light theme on error
            }
        };

        // Initialize theme based on user preference
        const initTheme = () => {
            try {
                const isDark = window.isDarkModePreferred();
                window.toggleTheme(isDark);
                console.log('Theme initialized to:', isDark ? 'dark' : 'light');
            } catch (error) {
                console.error('Error initializing theme:', error);
            }
        };

        // Run on page load
        document.addEventListener('DOMContentLoaded', () => {
            console.log('DOM content loaded, initializing theme...');
            initTheme();
        });

        // Run immediately as well
        console.log('Running immediate theme initialization...');
        initTheme();
    </script>
</body>

</html>
